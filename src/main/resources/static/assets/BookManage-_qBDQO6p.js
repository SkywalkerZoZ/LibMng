import{b as ye,d as ne,N as ke,c as j,k as u,u as he,a2 as we,J as Se,o as v,e as T,q as e,w as l,ad as re,f as a,s as S,L as Ee,a5 as Ce,n as U,a as P,h as O,t as K,g as A,E as ie,aD as Ve,ae as Be,T as Ie,aX as Ae,_ as $e,j as De,R as Pe,v as V,aY as Te,y as F,p as Le,aA as Re,a6 as Ue,ar as Ne,aZ as xe}from"./index-BEALDuwY.js";import{E as ze,v as Fe}from"./el-empty-DekdHT7T.js";import{_ as qe}from"./PageContainer-BVVqjsOY.js";import{E as Me}from"./el-pagination-CSgtznXV.js";import{E as Q}from"./el-input-DnAPq_uS.js";import{i as Oe,A as je,j as Ke,D as He,c as We,k as Ge,l as Je,E as Qe,a as Xe}from"./book-E4EKsRa-.js";import{d as Ye,c as Ze,u as et,E as ue,a as tt,b as lt}from"./el-dialog-DK3q9f31.js";import{d as at,b as ot}from"./el-tooltip-BvgAGTTK.js";import{E as st}from"./el-overlay-MJv4Atf-.js";import{E as X,a as Y}from"./el-form-item-BmTGu49f.js";import{E as Z}from"./el-button-CffIBoYX.js";import{E as nt}from"./el-progress-DEsFnGuc.js";/* empty css                */import{d as J}from"./defaultcover-BU2ujGGx.js";import{E as se}from"./el-message-box-CcJDXlBW.js";/* empty css                   */import{c as rt,_ as it}from"./_plugin-vue_export-helper-Cm_HEwFR.js";import"./isEqual-BDJixwU5.js";import"./_initCloneObject-9ZzmZcU1.js";import"./event-BB_Ol6Sd.js";import"./refs-Det0-stg.js";import"./castArray-DxzSp_WQ.js";import"./_baseClone-Bqs5NyXE.js";import"./validator-DhiFKoQh.js";const ut=ye({...Ye,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),dt=Ze,ct=["aria-label","aria-labelledby","aria-describedby"],pt=["id","aria-level"],mt=["aria-label"],vt=["id"],ft=ne({name:"ElDrawer",inheritAttrs:!1}),_t=ne({...ft,props:ut,emits:dt,setup(q,{expose:h}){const w=q,f=ke();rt({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},j(()=>!!f.title));const t=u(),E=u(),c=he("drawer"),{t:y}=we(),{afterEnter:k,afterLeave:L,beforeLeave:$,visible:n,rendered:D,titleId:_,bodyId:r,zIndex:p,onModalClick:g,onOpenAutoFocus:m,onCloseAutoFocus:z,onFocusoutPrevented:N,onCloseRequested:x,handleClose:R}=et(w,t),b=j(()=>w.direction==="rtl"||w.direction==="ltr"),M=j(()=>Se(w.size));return h({handleClose:R,afterEnter:k,afterLeave:L}),(d,B)=>(v(),T(Ae,{to:"body",disabled:!d.appendToBody},[e(Ie,{name:a(c).b("fade"),onAfterEnter:a(k),onAfterLeave:a(L),onBeforeLeave:a($),persisted:""},{default:l(()=>[re(e(a(st),{mask:d.modal,"overlay-class":d.modalClass,"z-index":a(p),onClick:a(g)},{default:l(()=>[e(a(at),{loop:"",trapped:a(n),"focus-trap-el":t.value,"focus-start-el":E.value,onFocusAfterTrapped:a(m),onFocusAfterReleased:a(z),onFocusoutPrevented:a(N),onReleaseRequested:a(x)},{default:l(()=>[S("div",Ee({ref_key:"drawerRef",ref:t,"aria-modal":"true","aria-label":d.title||void 0,"aria-labelledby":d.title?void 0:a(_),"aria-describedby":a(r)},d.$attrs,{class:[a(c).b(),d.direction,a(n)&&"open"],style:a(b)?"width: "+a(M):"height: "+a(M),role:"dialog",onClick:B[1]||(B[1]=Ce(()=>{},["stop"]))}),[S("span",{ref_key:"focusStartRef",ref:E,class:U(a(c).e("sr-focus")),tabindex:"-1"},null,2),d.withHeader?(v(),P("header",{key:0,class:U(a(c).e("header"))},[d.$slots.title?O(d.$slots,"title",{key:1},()=>[A(" DEPRECATED SLOT ")]):O(d.$slots,"header",{key:0,close:a(R),titleId:a(_),titleClass:a(c).e("title")},()=>[d.$slots.title?A("v-if",!0):(v(),P("span",{key:0,id:a(_),role:"heading","aria-level":d.headerAriaLevel,class:U(a(c).e("title"))},K(d.title),11,pt))]),d.showClose?(v(),P("button",{key:2,"aria-label":a(y)("el.drawer.close"),class:U(a(c).e("close-btn")),type:"button",onClick:B[0]||(B[0]=(...H)=>a(R)&&a(R)(...H))},[e(a(ie),{class:U(a(c).e("close"))},{default:l(()=>[e(a(Ve))]),_:1},8,["class"])],10,mt)):A("v-if",!0)],2)):A("v-if",!0),a(D)?(v(),P("div",{key:1,id:a(r),class:U(a(c).e("body"))},[O(d.$slots,"default")],10,vt)):A("v-if",!0),d.$slots.footer?(v(),P("div",{key:2,class:U(a(c).e("footer"))},[O(d.$slots,"footer")],2)):A("v-if",!0)],16,ct)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Be,a(n)]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"]))}});var bt=$e(_t,[["__file","drawer.vue"]]);const gt=De(bt),yt=["src"],kt={class:"dialog-footer"},ht={__name:"BookEdit",emits:["success"],setup(q,{expose:h,emit:w}){const f=u(!1),t=u({id:"",title:"",isbn:"",author:"",description:"",cover:""}),E=u(),c={},y=u(!0),k=_=>{f.value=!0,t.value={..._},_&&_.isbn?(y.value=!0,t.value.id=t.value.title,n.value=t.value.cover?`data:image/jpeg;base64,${t.value.cover}`:J):(y.value=!1,t.value={id:"",title:"",isbn:"",author:"",description:"",cover:""},n.value=J)},L=w,$=async()=>{await E.value.validate(),y.value?(await Oe(t.value),F.success("Successful Addition")):(await je(t.value),F.success("Successful Deletion")),f.value=!1,n.value="",L("success")};h({open:k});const n=u(""),D=_=>{const r=new FileReader;r.onload=()=>{const p=r.result;n.value=p;const g=r.result.split(",")[1];t.value.cover=g,console.log(t.value.cover)},r.readAsDataURL(_.raw)};return Pe(()=>{n.value=J}),(_,r)=>{const p=Q,g=X,m=ie,z=nt,N=Y,x=Z,R=ue;return v(),T(R,{title:t.value.id?"Editing books":"Add book info",modelValue:f.value,"onUpdate:modelValue":r[6]||(r[6]=b=>f.value=b),width:"30%"},{footer:l(()=>[S("span",kt,[e(x,{onClick:r[5]||(r[5]=b=>f.value=!1)},{default:l(()=>[V("Cancel")]),_:1}),e(x,{type:"primary",onClick:$},{default:l(()=>[V("OK")]),_:1})])]),default:l(()=>[e(N,{ref_key:"formRef",ref:E,model:t.value,rules:c,"label-width":"100px",style:{"padding-right":"30px"}},{default:l(()=>[e(g,{prop:"title",label:"Title"},{default:l(()=>[e(p,{modelValue:t.value.title,"onUpdate:modelValue":r[0]||(r[0]=b=>t.value.title=b),placeholder:"Please enter the book title"},null,8,["modelValue"])]),_:1}),e(g,{prop:"isbn",label:"ISBN"},{default:l(()=>[e(p,{modelValue:t.value.isbn,"onUpdate:modelValue":r[1]||(r[1]=b=>t.value.isbn=b),placeholder:"Please enter the ISBN",disabled:!!t.value.id},null,8,["modelValue","disabled"])]),_:1}),e(g,{prop:"author",label:"Author"},{default:l(()=>[e(p,{modelValue:t.value.author,"onUpdate:modelValue":r[2]||(r[2]=b=>t.value.author=b),placeholder:"Please enter the book author"},null,8,["modelValue"])]),_:1}),e(g,{prop:"description",label:"Description"},{default:l(()=>[e(p,{modelValue:t.value.description,"onUpdate:modelValue":r[3]||(r[3]=b=>t.value.description=b),placeholder:"Please enter description"},null,8,["modelValue"])]),_:1}),e(g,{prop:"location",label:"Location"},{default:l(()=>[e(p,{modelValue:t.value.location,"onUpdate:modelValue":r[4]||(r[4]=b=>t.value.location=b),placeholder:"Please enter location"},null,8,["modelValue"])]),_:1}),e(g,{prop:"cover",label:"Cover"},{default:l(()=>[e(z,{class:"avatar-uploader","show-file-list":!1,"auto-upload":!1,"on-change":D},{default:l(()=>[n.value?(v(),P("img",{key:0,src:n.value,style:{"max-width":"100%","max-height":"200px"}},null,8,yt)):(v(),T(m,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[e(a(Te))]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}},wt={class:"dialog-footer"},St={__name:"Instance",emits:["success"],setup(q,{expose:h,emit:w}){const f=u(!1),t=u({id:"",number:"",isbn:"",add:""}),E=u(),c={number:[{required:!0,message:"Please enter the quantity",trigger:"blur"},{pattern:/^(?:[1-9]|[1-9]\d|100)$/,message:"Must be an integer and less than 100",trigger:"blur"}],id:[{required:!0,message:"Please enter id",trigger:"blur"},{pattern:/^(?:[1-9]|[1-9]\d|1000000)$/,message:"Must be a number",trigger:"blur"}]},y=($,n)=>{f.value=!0,t.value.isbn=$,t.value.add=-n,n&&(t.value.id=n),console.log(t.value)},k=w,L=async()=>{await E.value.validate(),t.value.add>0?(await Ke({isbn:t.value.isbn,number:t.value.number}),F.success("Successful Book Acquisition")):(await He(t.value.id),F.success("Successful Book Withdrawal")),f.value=!1,t.value={id:"",number:"",isbn:"",add:""},k("success")};return h({openIns:y}),($,n)=>{const D=Q,_=X,r=Y,p=Z,g=ue;return v(),T(g,{title:t.value.add>0?"Book Acquisition":"Book Withdrawal",modelValue:f.value,"onUpdate:modelValue":n[4]||(n[4]=m=>f.value=m),width:"30%"},{footer:l(()=>[S("span",wt,[e(p,{onClick:n[3]||(n[3]=m=>f.value=!1)},{default:l(()=>[V("Cancel")]),_:1}),e(p,{type:"primary",onClick:L},{default:l(()=>[V("OK")]),_:1})])]),default:l(()=>[e(r,{ref_key:"formRef",ref:E,model:t.value,rules:c,"label-width":"100px",style:{"padding-right":"30px"}},{default:l(()=>[e(_,{prop:"isbn",label:"ISBN:"},{default:l(()=>[e(D,{modelValue:t.value.isbn,"onUpdate:modelValue":n[0]||(n[0]=m=>t.value.isbn=m),disabled:!!t.value.isbn},null,8,["modelValue","disabled"])]),_:1}),t.value.add>0?(v(),T(_,{key:0,prop:"number",label:"Quantity:"},{default:l(()=>[e(D,{modelValue:t.value.number,"onUpdate:modelValue":n[1]||(n[1]=m=>t.value.number=m),placeholder:"Please enter the quantity to be added"},null,8,["modelValue"])]),_:1})):A("",!0),t.value.add<0?(v(),T(_,{key:1,prop:"id",label:"Book ID:"},{default:l(()=>[e(D,{modelValue:t.value.id,"onUpdate:modelValue":n[2]||(n[2]=m=>t.value.id=m),disabled:!!t.value.isbn},null,8,["modelValue","disabled"])]),_:1})):A("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"])}}},Et={class:"form-row"},Ct=["title"],Vt={class:"ellipsis"},Bt={style:{display:"flex"}},It={style:{"margin-bottom":"20px"}},At={key:0},$t={key:1},Dt={class:"button-container",style:{display:"flex"}},Pt={class:"pagination"},Tt={__name:"BookManage",setup(q){const h=u([]),w=u(!1),f=u(),t=u(),E=u(0),c=u(1),y=u(10),k=async()=>{w.value=!0;const i=(await We()).data.data;h.value=i,E.value=h.value.length,w.value=!1};k();const L=j(()=>{const s=(c.value-1)*y.value,i=s+y.value;return h.value.slice(s,i)}),$=s=>{f.value.open(s)},n=()=>{f.value.open({})},D=async s=>{await se.confirm("Are you sure you want to delete it?","Tip",{type:"warning",confirmButtonText:"OK",cancelButtonText:"Cancel"}),await Ge(s.isbn),F.success("Successful Deletion"),k()},_=s=>{k(),ee(s)},r=u([{value:"title",label:"Title"},{value:"author",label:"Author"},{value:"isbn",label:"ISBN"}]),p=u("title"),g=s=>{if(s==="title")return"Please enter the title";if(s==="author")return"Please enter the author";if(s==="isbn")return"Please enter the ISBN"},m=u(""),z=()=>{const s=h.value.filter(i=>{if(p.value==="title")return i.title.includes(m.value);if(p.value==="author")return i.author.includes(m.value);if(p.value==="isbn")return i.isbn.includes(m.value)});h.value.splice(0,h.value.length,...s)},N=()=>{m.value="",k()},x=s=>{t.value.openIns(s,-1)},R=(s,i,I)=>{I===1?se.alert("This book is currently on loan and cannot be deleted!","Tip: ",{confirmButtonText:"OK"}):t.value.openIns(s,i)},b=s=>{y.value=s,c.value=1,k()},M=s=>{c.value=s,k()};Le(p,s=>{console.log(s),N()});const d=u(!1),B=u(),H=s=>{d.value=!0,B.value=s,ee(B.value),console.log(W.value)},W=u([]),ee=async s=>{const i=await Je(s);W.value=i.data.data};return(s,i)=>{const I=Z,de=lt,ce=tt,pe=Q,te=X,me=Y,C=Qe,le=ot,ve=ze,ae=Xe,fe=gt,_e=Me,be=qe,ge=Fe;return v(),T(be,{title:"Book Catalog"},{extra:l(()=>[e(I,{onClick:n},{default:l(()=>[V("Add New Book")]),_:1})]),default:l(()=>[e(me,{inline:""},{default:l(()=>[S("div",Et,[e(ce,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=o=>p.value=o),placeholder:"Please Select",class:"select-box"},{default:l(()=>[(v(!0),P(Ue,null,Re(r.value,o=>(v(),T(de,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(te,null,{default:l(()=>[e(pe,{modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=o=>m.value=o),placeholder:g(p.value),clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(te,null,{default:l(()=>[e(I,{type:"primary",onClick:z},{default:l(()=>[V("Search")]),_:1}),e(I,{onClick:N},{default:l(()=>[V("Reset")]),_:1})]),_:1})])]),_:1}),re((v(),T(ae,{data:L.value,style:{width:"100%"}},{empty:l(()=>[e(ve,{description:"No data"})]),default:l(()=>[e(C,{prop:"title",label:"Title"}),e(C,{prop:"isbn",label:"ISBN"},{default:l(({row:o})=>[e(le,{class:"item",effect:"dark",placement:"bottom",content:o.isbn},{default:l(()=>[S("div",{class:"ellipsis",title:o.isbn},K(o.isbn),9,Ct)]),_:2},1032,["content"])]),_:1}),e(C,{prop:"author",label:"Author"}),e(C,{prop:"description",label:"Description "},{default:l(({row:o})=>[e(le,{class:"item",effect:"dark",placement:"bottom",content:o.description},{default:l(()=>[S("div",Vt,K(o.description),1)]),_:2},1032,["content"])]),_:1}),e(C,{prop:"available",label:"Number of existing"}),e(C,{prop:"borrowed",label:"Number of borrowed"}),e(C,{label:"operation",width:"250px"},{default:l(({row:o,$index:G})=>[S("div",Bt,[e(I,{icon:a(Ne),circle:"",type:"primary",plain:"",onClick:oe=>$(o,G)},null,8,["icon","onClick"]),e(I,{icon:a(xe),circle:"",type:"danger",plain:"",onClick:oe=>D(o,G)},null,8,["icon","onClick"]),e(I,{onClick:oe=>H(o.isbn),type:"primary",size:"small"},{default:l(()=>[V("List")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ge,w.value]]),e(fe,{modelValue:d.value,"onUpdate:modelValue":i[3]||(i[3]=o=>d.value=o),title:"Instance table",direction:"rtl",size:"50%"},{default:l(()=>[S("div",It,[V(" Instance ISBN: "+K(B.value)+" ",1),e(I,{type:"primary",plain:"",size:"small",onClick:i[2]||(i[2]=o=>x(B.value)),style:{"margin-left":"30px"}},{default:l(()=>[V("Book Acquisition")]),_:1})]),S("div",null,[e(ae,{data:W.value},{default:l(()=>[e(C,{label:"instanceId",prop:"instanceId"}),e(C,{label:"borrowStatus",prop:"borrowStatus"},{default:l(o=>[o.row.borrowStatus===0?(v(),P("span",At,"Not borrowed")):A("",!0),o.row.borrowStatus===1?(v(),P("span",$t,"Borrowed")):A("",!0)]),_:1}),e(C,{label:"addTime",prop:"addTime"}),e(C,{label:"操作"},{default:l(({row:o})=>[S("div",Dt,[e(I,{type:"danger",size:"small",plain:"",onClick:G=>R(o.isbn,o.instanceId,o.borrowStatus)},{default:l(()=>[V("Book Withdrawal")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),e(ht,{ref_key:"dialog1",ref:f,onSuccess:_},null,512),e(St,{ref_key:"dialog2",ref:t,onSuccess:i[4]||(i[4]=o=>_(B.value))},null,512),S("div",Pt,[e(_e,{"current-page":c.value,"onUpdate:currentPage":i[5]||(i[5]=o=>c.value=o),"page-size":y.value,"onUpdate:pageSize":i[6]||(i[6]=o=>y.value=o),layout:"total,prev, pager, next, jumper",total:E.value,onSizeChange:b,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1})}}},ol=it(Tt,[["__scopeId","data-v-80d64a4e"]]);export{ol as default};
